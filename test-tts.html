<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test TTS Direct</title>
</head>
<body>
    <h1>Test TTS Direct</h1>
    <button onclick="testBasicTTS()">Test Basic TTS</button>
    <button onclick="testWithDelay()">Test avec dÃ©lai</button>
    <button onclick="checkVoices()">VÃ©rifier voix</button>
    <div id="output"></div>

    <script>
        const output = document.getElementById('output');
        
        function log(message) {
            console.log(message);
            output.innerHTML += '<p>' + message + '</p>';
        }
        
        function testBasicTTS() {
            log('=== Test Basic TTS ===');
            log('speechSynthesis supported: ' + ('speechSynthesis' in window));
            
            if ('speechSynthesis' in window) {
                // Stop any existing speech
                speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance('Bonjour, test de synthÃ¨se vocale');
                
                utterance.onstart = () => log('âœ… TTS Started');
                utterance.onend = () => log('âœ… TTS Ended');
                utterance.onerror = (e) => log('âŒ TTS Error: ' + e.error);
                
                log('Ã‰tat avant speak():');
                log('- speaking: ' + speechSynthesis.speaking);
                log('- pending: ' + speechSynthesis.pending);
                log('- paused: ' + speechSynthesis.paused);
                
                log('ðŸ“¢ Calling speechSynthesis.speak()...');
                speechSynthesis.speak(utterance);
                
                setTimeout(() => {
                    log('Ã‰tat aprÃ¨s 100ms:');
                    log('- speaking: ' + speechSynthesis.speaking);
                    log('- pending: ' + speechSynthesis.pending);
                    log('- paused: ' + speechSynthesis.paused);
                }, 100);
                
                setTimeout(() => {
                    log('Ã‰tat aprÃ¨s 2s:');
                    log('- speaking: ' + speechSynthesis.speaking);
                    log('- pending: ' + speechSynthesis.pending);
                    log('- paused: ' + speechSynthesis.paused);
                }, 2000);
            }
        }
        
        function testWithDelay() {
            log('=== Test avec dÃ©lai ===');
            setTimeout(() => {
                speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance('Test avec dÃ©lai de 1 seconde');
                utterance.onstart = () => log('âœ… TTS Delayed Started');
                utterance.onend = () => log('âœ… TTS Delayed Ended');
                utterance.onerror = (e) => log('âŒ TTS Delayed Error: ' + e.error);
                log('ðŸ“¢ Speaking avec dÃ©lai...');
                speechSynthesis.speak(utterance);
            }, 1000);
        }
        
        function checkVoices() {
            log('=== VÃ©rification des voix ===');
            const voices = speechSynthesis.getVoices();
            log('Nombre de voix: ' + voices.length);
            
            if (voices.length === 0) {
                log('âŒ Aucune voix trouvÃ©e, Ã©coute onvoiceschanged...');
                speechSynthesis.onvoiceschanged = () => {
                    const newVoices = speechSynthesis.getVoices();
                    log('âœ… Voix aprÃ¨s onvoiceschanged: ' + newVoices.length);
                    newVoices.slice(0, 5).forEach((voice, i) => {
                        log(`  Voix ${i}: ${voice.name} (${voice.lang}) ${voice.localService ? '[Local]' : '[Remote]'}`);
                    });
                };
            } else {
                log('âœ… Voix trouvÃ©es:');
                voices.slice(0, 5).forEach((voice, i) => {
                    log(`  Voix ${i}: ${voice.name} (${voice.lang}) ${voice.localService ? '[Local]' : '[Remote]'}`);
                });
            }
        }
        
        // Auto-check voices au chargement
        window.onload = () => {
            log('ðŸš€ Page chargÃ©e, vÃ©rification automatique...');
            checkVoices();
            
            // Test automatique aprÃ¨s 2 secondes
            setTimeout(() => {
                log('ðŸŽ¯ Test automatique...');
                testBasicTTS();
            }, 2000);
        };
    </script>
</body>
</html>